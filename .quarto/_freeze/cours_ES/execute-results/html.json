{
  "hash": "0a50e74f4479b31ebd449cddc31c163b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"How to calculate and combine effect-sizes?\"\nsubtitle: \"September 2024\"\nauthors: \"Damien Beillouin  <br/> \nCIRAD-Hortsys\"\nformat:\n  revealjs:\n    width: 1150\n    margin: 0.08\n    transition: slide\n    background-transition: fade\n    slide-number: true\n    show-slide-number: print\n    footer: \"How to calculate and combine effect-sizes?\"\nfilters:\n  - shinylive\neditor: visual\ntitle-slide-attributes: \n  data-background-image: elephant.png\n  data-background-size: 25%\n  data-background-position: 90% 80%\ninclude-in-header:\n  - text: |\n      <style>\n      #title-slide .title {\n        font-size: 1.5em;\n        color: black;\n      }\n      </style>\n---\n\n\n\n## What is an effect-size?\n\n<br> A metric that quantifies the **direction** and **magnitude** of an experimental/observational effect:\n\n-   **Extracted directly** from publications or **calculated** from reported data\n\n-   **Standardized** to be comparable across multiple primary studies\n\n-   **Reliable**: effectively represent the underlying data (e.g., be careful of ratios with low denominators)\n\n## What is an effect-size (Visually)?\n\n![](images/effect_size_global.png)\n\n## Effect-size and p-value\n\n<br>\n\n-   **Statistical vs. Practical Significance**\\\n    Small effect sizes can produce significant p-values with large samples but have little real-world impact.\n\n-   **Impact of Sample Size**\\\n    Large datasets make even tiny effects statistically significant, risking misinterpretation.\n\n-   **Criticisms of p-values**\\\n    see e.g., [Hasley, 2019](https://royalsocietypublishing.org/doi/10.1098/rsbl.2019.0174); [Chen et al., 2023](https://www.cell.com/patterns/fulltext/S2666-3899(23)00270-2?dgcid=raven_jbs_etoc_email)). Complement with confidence intervals or Bayesian approaches.\n\n## Effect-size and p-value\n\n![](images/ES_and_p_value.png){fig-align=\"center\"} In Goedart, 2018\n\n## True vs. Estimated Effect Size\n\n<br>\n\nEffect sizes are typically represented by the Greek letter theta (Œ∏):\n\n-   $ùúÉ‚Çñ$: the ‚Äòtrue‚Äô (unknown) effect size of study *k*\\\n\n-   $\\hat{ùúÉ‚Çñ}$ : the observed (estimated) effect size from data in study *k*\n\n    \\\n    The observed effect size deviates from the true effect size due to **sampling error**:\n\n-   $ùúÉ‚Çñ$ **‚â†** $\\hat{ùúÉ‚Çñ}$ because $ùúÉ‚Çñ$ = $\\hat{ùúÉ‚Çñ}$+ $ùúÄ‚Çñ$ (where $ùúÄ‚Çñ$ is the sampling error)\n\n## **Goal of meta-analysis**\n\n\\\nReduce sampling error to produce accurate estimates that are as close as possible to the **true effect size**.\n\n## We do not know much\n\nUnknown parameters:\n\n-   $ùúÉ‚Çñ$, $\\hat{ùúÉ‚Çñ}$, Œµ‚Çñ,\n\nWhat we do:\n\n==\\> $\\hat{ùúÉ‚Çñ}$¬†ÃÇ : Estimated through the mean value (of a sampling distribution)\n\n==\\> Œµ‚Çñ : Estimated through the standard error (SE).\n\n(standard error of the mean : ùëÜùê∏= ùë†/‚àöùëõ ; with n: sample size, s: standard dev)\n\n## In a perfect world\n\nImagine we know the **true mean** (Œº) and **standard deviation** (œÉ) of a distribution perfectly.\n\ne.g.\n\n-   mu \\<- 100 \\# True mean\n\n-   sigma \\<- 15 \\# True standard deviation\n\n## True or estimated effect-size?\n\n-   **What happens if we sample this distribution?**\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 600\n\n# Load necessary libraries\nlibrary(shiny)\nlibrary(ggplot2)\nlibrary(plotly)\n\n# Define UI for the application\nui <- fluidPage(\n    titlePanel(\"Effect of Sample Size on Parameter Estimation\"),\n    sidebarLayout(\n        sidebarPanel(\n            sliderInput(\"sampleSize\", \n                        \"Select Sample Size:\", \n                        min = 5, \n                        max = 500, \n                        value = 50, \n                        step = 5)\n        ),\n        mainPanel(\n            plotlyOutput(\"densityPlot\")\n        )\n    )\n)\n\n# Define server logic for the plot\nserver <- function(input, output) {\n    output$densityPlot <- renderPlotly({\n        # Set parameters\n        mu <- 100  # True mean\n        sigma <- 15  # True standard deviation\n        \n        # Generate sample based on slider input\n        sample_size <- input$sampleSize\n        sample_data <- rnorm(sample_size, mean = mu, sd = sigma)\n        \n        # Create data frame for plotting\n        df <- data.frame(value = sample_data)\n        \n        # Plot density\n        p <- ggplot(df, aes(x = value)) +\n            geom_density(fill = \"blue\", alpha = 0.5) +\n            geom_vline(aes(xintercept = mu), color = \"red\", linetype = \"dashed\", size = 1) +\n            labs(title = paste(\"Sample Size:\", sample_size),\n                 x = \"Value\",\n                 y = \"Density\") +\n            theme_minimal()\n        \n        ggplotly(p)\n    })\n}\n\n# Run the application \nshinyApp(ui = ui, server = server)\n\n\n```\n\n## An Effect Size for All Your Needs\n\n<br/>\n\nDepending on your experimental design, research question, and the type of outcome you are interested in, various effect sizes can be applicable.\n\n## An Effect Size for All Your Needs {.smaller}\n\n-   Continuous outcomes\n\n| **Effect Type**             | **Description**                                                    |\n|-------------------------------|-----------------------------------------|\n| **Cohen's d**               | Effect size between two means.                                     |\n| **Hedges' g**               | Corrected Cohen's d for small samples.                             |\n| **Correlation (r)**         | Strength and direction of a linear relationship.                   |\n| **Eta-squared ((**\\eta\\^2)) | Proportion of variance explained in ANOVA.                         |\n| **Partial Eta-squared**     | Proportion of variance explained by an effect, controlling others. |\n\n## An Effect Size for All Your Needs {.smaller}\n\n-   Continuous outcomes\n\n![](images/conversion_ES.png){fig-align=\"center\"}\n\n## An Effect Size for All Your Needs {.smaller}\n\n-   Discrete outcomes\n\n| **Effect Type**     | **Description**                                          |\n|-----------------------------|-------------------------------------------|\n| **Odds Ratio (OR)** | Measures the strength of association between two events. |\n| **Risk Ratio (RR)** | Compares the risk of an event between two groups.        |\n| **Phi Coefficient** | Measures the association between two binary variables.   |\n\n## Mean Difference (MD) Calculation {.smaller}\n\n#### 1. Mean Difference (MD)\n\n$$MD = M_1 - M_2 $$ with M1: Mean of group 1 - M2: Mean of group 2\n\n#### 2. Standard Error of the Mean Difference (SE MD)\n\n$$SE_{MD} = SD_{pooled}\\sqrt{\\frac{1}{n_1} + \\frac{1}{n_2}}$$ With- SD1 : Standard deviation of group 1 - SD2 : Standard deviation of group 2 - n1 , n_2 : Sample sizes\n\n#### 3. Pooled Standard Deviation (spooled)\n\n$$SD_{pooled} = \\sqrt{\\frac{(n_1 - 1) \\cdot SD_1^2 + (n_2 - 1) \\cdot SD_2^2}{n_1 + n_2 - 2}}$$\n\n------------------------------------------------------------------------\n\n## Plant Growth in Different Soil Types {.smaller}\n\n| Variable                  | Soil A | Soil B |\n|---------------------------|--------|--------|\n| Mean Height ((M))         | 25 cm  | 20 cm  |\n| Standard Deviation ((SD)) | 4 cm   | 5 cm   |\n| Sample Size ((n))         | 30     | 30     |\n\n#### Calculations\n\n1.  **Mean Difference**: $$\n    MD = 25 - 20 = 5 \\text{ cm}\n    $$\n\n2.  **Pooled Standard Deviation**:\n\n$$\nSE_{MD} = \\sqrt{\\frac{(30 - 1) \\cdot 4^2 + (30 - 1) \\cdot 5^2}{30 + 30 - 2}} \\cdot \\sqrt{\\frac{1}{30} + \\frac{1}{30} } = 1.18\n$$\n\n## Variables to Retrieve from Primary Studies {.smaller}\n\n1.  **Mean ((M))**\n    -   For each compared group.\n2.  **Standard Deviation ((SD))**\n    -   Standard deviation for each group.\n3.  **Sample Size ((n))**\n    -   Number of observations in each group.\n\n## Advantages and Disadvantages of Mean Difference (MD) {.smaller}\n\n<br/>\\\n\n#### Advantages:\n\n-   **Simplicity**: Easy to understand and interpret.\n-   **Direct Measurement**: Represents a direct measure of the effect between two groups.\n-   **General Applicability**: Useful across various fields (biology, psychology, etc.).\n\n#### Disadvantages:\n\n-   **Sensitivity to Samples**: Can be influenced by sample variability.\n-   **Data Distribution**: Requires a normal distribution for valid interpretations.\n\n## Standardized Mean Difference (Cohens'd) {.smaller}\n\n$$\nd = \\frac{M_1 - M_2}{S_{within}}\n$$\n\n$$\nS_{within} = \\sqrt{\\frac{(n_1 - 1)S_1^2 + (n_2 - 1)S_2^2}{n_1 + n_2 - 2}}\n$$\n\nWhere: - M_1 and M_2 represent the sample means of the two groups. S\\_{within}, is the pooled within-groups standard deviation: - n_1 and n_2 are the sample sizes of the two groups, - S_1 and S_2 are the standard deviations of the two groups.\n\n$$\nSE_d = \\sqrt{\\frac{n_1 + n_2}{n_1 n_2} + \\frac{d^2}{2(n_1 + n_2)}}\n$$\n\n## Standardized Mean Difference (Cohens'd)\n\n-   Interpretation : SMD= 2 -\\> a difference of 2 standard deviations\n-   BUT bias when the sample size of a study is small, especially when n‚â§ 20 (L. V. Hedges 1981).\n\n## Hedges' (g)\n\n$$\ng = d \\times \\left(1 - \\frac{3}{4N - 1}\\right)\n$$ - (N): Total sample size ( (N = n_1 + n_2) )\n\n$$\nSE_g = \\sqrt{J^2\\times SE_d^2}\n$$\n\n## Plant growth in different soil {.smaller}\n\n| Variable                  | Soil A | Soil B |\n|---------------------------|--------|--------|\n| Mean Height ((M))         | 25 cm  | 20 cm  |\n| Standard Deviation ((SD)) | 4 cm   | 5 cm   |\n| Sample Size ((n))         | 30     | 30     |\n\n#### Calculations\n\n2.  **Cohen's (d)**: $$\n    d = \\frac{5}{4.58} \\approx 1.09 \n    $$\n\n3.  **Hedges' (g)**: $$\n    g = 1.09 \\times \\left(1 - \\frac{3}{4(60) - 1}\\right) \\approx 1.08\n    $$\n\n## Advantages and Disadvantages of Cohen's (d) and Hedges' (g) {.smaller}\n\n#### Advantages:\n\n-   **Standardized Measure**: Allows for comparison across studies.\n-   **Applicability**: Useful in various fields (ecology, psychology, etc.).\n\n#### Disadvantages:\n\n-   **Sample Size Sensitivity**: May be affected by small sample sizes.\n-   **Assumption of Normality**: Requires normality for accurate interpretation.\n-   **Interpretability**: Not so clear understanding of effect sizes.\n\n## Ratio Calculation {.smaller}\n\n#### 1. **Ratio (R)**\n\n$$R = \\frac{X_1}{X_2} $$\n\n-   X_1: Mean value or proportion in group 1\\\n-   X_2: Mean value or proportion in group 2\n\nwhere: - $SD_{\\text{pooled}}$: Pooled standard deviation - $X_1$: Mean of group 1 - $X_2$: Mean of group 2 - $n_1, n_2$: Sample sizes of the two groups\n\n## Ratio :non-normal distribution {.smaller}\n\n-   Lead to non normal distribution\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](cours_ES_files/figure-revealjs/unnamed-chunk-1-1.png){width=960}\n:::\n:::\n\n\n\n## Logarithmic Transformation for Ratio\n\n$$\\log R = \\ln\\left(\\frac{X_1}{X_2}\\right)$$ Log transformation is often used to stabilize variance and normalize the distribution.\n\n$$\nSE_{\\ln R} = SD_{\\text{pooled}} \\sqrt{ \\left( \\frac{1}{n_1 \\cdot (X_1)^2} \\right) + \\left( \\frac{1}{n_2 \\cdot (X_2)^2} \\right) }\n$$\n\nwhere: - $SE_{\\ln R}$: Standard error of the log response ratio - $SD_{\\text{pooled}}$: Pooled standard deviation - $X_1$: Mean of group 1 - $X_2$: Mean of group 2 - $n_1, n_2$: Sample sizes of the two groups\n\n## Logarithmic Transformation for Ratio\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](cours_ES_files/figure-revealjs/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n\n\n\n## Adjustments for Ratio-Based Effect Sizes {.smaller}\n\n\n1. **Correction for Small Sample Size**:\n   - **Log Response Ratio (LnR)** tends to be biased when sample sizes are small.\n   - Apply bias corrections to reduce overestimation or underestimation.\n   - Variance estimations need adjustment, especially when the response ratio is highly skewed.\n\n\n\n#### Corrected Log Response Ratio (LnR_corr)\n\n$$ \\text{LnR}_{corr} = \\ln\\left(\\frac{X_1}{X_2}\\right) - \\frac{1}{2} \\cdot \\left(\\frac{SD_{X1}^2}{n_1 X_1^2} + \\frac{SD_{X2}^2}{n_2 X_2^2}\\right) $$\n\nWhere:  \n- \\( X_1, X_2 \\): Group means.  \n- \\( SD_{X1}, SD_{X2} \\): Standard deviations.  \n- \\( n_1, n_2 \\): Sample sizes.  \n\n**References**:  **Lajeunesse, M. J. (2011)**\n\n## Comparing Plant Growth {.smaller}\n\n| Variable                | Soil A | Soil B |\n|-------------------------|--------|--------|\n| Mean Plant Height (X)   | 25 cm  | 20 cm  |\n| Standard Deviation (SD) | 4 cm   | 5 cm   |\n| Sample Size (n)         | 30     | 30     |\n\n#### Ratio and LogRatio\n\n$$ R = \\frac{25}{20} = 1.25 $$ and $$\\log R = \\ln(1.25) \\approx 0.223$$\n\n#### Standard Error of Log Ratio (SE Log Ratio):\n\n$$ SE_{\\ln R} = 4.53 \\cdot \\sqrt{ \\left( \\frac{1}{30 \\cdot 25^2} \\right) + \\left( \\frac{1}{30 \\cdot 20^2} \\right) } \\approx 0.053 $$\n\n## Correlation {.smaller}\n\n#### Correlation Coefficient (r)\n\n$$ r = \\frac{Cov(X, Y)}{SD_X \\cdot SD_Y} $$\n\nWhere: - ( Cov(X, Y) ): Covariance between variables ( X ) and ( Y ) - ( SD_X ): Standard deviation of variable ( X ) - ( SD_Y ): Standard deviation of variable ( Y )\n\n#### Standard Error of the Correlation Coefficient (SE)\n\n$$ SE_r = \\frac{1 - r^2}{\\sqrt{n - 2}} $$\n\nWhere: - n: Sample size\n\n## Correlation {.smaller}\n\n-   Non normal distribution\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 600\nlibrary(shiny)\nlibrary(ggplot2)\nlibrary(plotly)\n\n# Fonction pour g√©n√©rer des donn√©es avec une corr√©lation sp√©cifi√©e\ngenerate_data <- function(n, correlation_target) {\n  correlations <- replicate(n, {\n    x <- rnorm(20, mean = 10, sd = 1)  # Variable ind√©pendante\n    y <- correlation_target * x + rnorm(20, mean = 0, sd = sqrt(1 - correlation_target^2))  # Variable d√©pendante\n    cor(x, y)  # Calcul de la corr√©lation\n  })\n  \n  return(data.frame(Iteration = 1:n, Correlation = correlations))\n}\n\n# Transformation de Fisher\nfisherz <- function(r) {\n  return(0.5 * log((1 + r) / (1 - r)))\n}\n\n# Interface utilisateur\nui <- fluidPage(\n  titlePanel(\"Simulation de Corr√©lation\"),\n  sidebarLayout(\n    sidebarPanel(\n      sliderInput(\"sample_size\",\n                  \"Taille de l'√©chantillon:\",\n                  min = 5,\n                  max = 200,\n                  value = 15),\n      sliderInput(\"correlation_target\",\n                  \"Corr√©lation cible:\",\n                  min = -1,\n                  max = 1,\n                  value = 0.8,\n                  step = 0.01)\n    ),\n    mainPanel(\n      plotlyOutput(\"densityPlot\")  # Utilisation de plotly pour l'histogramme\n    )\n  )\n)\n\n# Serveur\nserver <- function(input, output) {\n    output$densityPlot <- renderPlotly({\n        # G√©n√©rer les donn√©es\n        data <- generate_data(input$sample_size, input$correlation_target)\n        \n        # Transformation de Fisher sur les corr√©lations\n        data$Fisher <- fisherz(data$Correlation)\n        \n        # Cr√©er le graphique de densit√©\n        p <- ggplot(data) +\n            geom_density(aes(x = Correlation, y = ..density..), fill = \"lightblue\", alpha = 0.5) +\n            geom_density(aes(x = Fisher, y = ..density..), color = \"red\", size = 1)  +\n            ggtitle(\"Densit√© des Corr√©lations et Transform√©es par Fisher\") +\n            xlab(\"Valeurs\") +\n            ylab(\"Densit√©\") +\n            theme_minimal() +\n            scale_color_manual(name = \"L√©gende\", values = c(\"lightblue\" = \"Brutes\", \"red\" = \"Fisher\", \"green\" = \"Normale\")) +\n            labs(color = \"Type de Densit√©\")\n        \n        # Convertir ggplot en plotly\n        ggplotly(p)\n    })\n}\n\n# Lancer l'application\nshinyApp(ui = ui, server = server)\n\n\n\n```\n\n\n## Fisher's Transformation {.smaller}\n\nFisher's transformation is used to stabilize the variance and make the sampling distribution of the correlation coefficient more normal:\n\n$$ z_r = \\frac{1}{2} \\cdot \\ln \\left( \\frac{1 + r}{1 - r} \\right) $$\n\nWhere:  \n- r: Observed correlation coefficient  \n- z_r: Fisher-transformed value  \n\n\n##### Standard Error of \\( z_r \\)\n\n$$ SE_{z_r} = \\frac{1}{\\sqrt{n - 3}} $$\n\nWhere:  \n- n : Sample size  \n\n\n## Key Takeaways: Soil Experiment Example {.smaller}\n\n- **Comparison of Plant Growth in Two Soil Types**:\n\n  | **Variable**             | **Soil A** | **Soil B** |\n  |--------------------------|------------|------------|\n  | **Mean Height**          | 25 cm      | 20 cm      |\n  | **Standard Deviation**   | 4 cm       | 5 cm       |\n  | **Sample Size (n)**      | 30         | 30         |\n\n- **Effect Size Calculations**:\n  - **Mean Difference (MD)**: 5 cm  \n  - **Cohen‚Äôs d**: 1.09  \n  - **Hedges‚Äô g**: 1.08  \n  - **Ratio**: 1.25  \n  - **log(Ratio)**: 0.0223\n\n\n\n---\n\n## Important Considerations for Effect Sizes {.smaller}\n\n1. **Data Characteristics**:\n   - Ensure assumptions of normality and homogeneity of variance are met.\n   - Consider small sample size biases, especially with Cohen‚Äôs d.\n\n2. **Interpretation**:\n   - Choose the appropriate effect size based on study design (e.g., continuous vs. categorical data).\n   - Understand practical significance beyond just statistical significance.\n\n3. **Use of Correct Formulas**:\n   - When sample sizes differ, use **pooled standard deviations** for accurate mean differences.\n   - Apply corrections like Hedges‚Äô g for small sample sizes to minimize bias.\n\n---\n\n## Key References for Effect Size Calculations {.smaller}\n\n1. **Borenstein et al. (2009)**:\n   - Comprehensive guide on effect size calculations and interpretations.\n   - Essential for meta-analyses and evidence synthesis.\n\n2. **The `esc` and `metafor` Packages**:\n   - R tools for calculating various effect sizes.\n   - Use `metafor` for meta-analytic models and conversions between effect types.\n\n3. **Practical Meta-Analysis (Lipsey & Wilson)**:\n   - Resource for practical guidance on interpreting and reporting effect sizes.\n   - Includes guidance on which effect size to use based on research context.\n\n",
    "supporting": [
      "cours_ES_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}