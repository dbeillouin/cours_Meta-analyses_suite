{"title":"How to calculate and combine effect-sizes?","markdown":{"yaml":{"title":"How to calculate and combine effect-sizes?","subtitle":"September 2024","authors":"Damien Beillouin  <br/> CIRAD-Hortsys","format":{"revealjs":{"chalkboard":true,"width":1150,"margin":0.08,"transition":"slide","background-transition":"fade","slide-number":true,"show-slide-number":"print","footer":"How to calculate and combine effect-sizes?"}},"filters":["shinylive"],"editor":"visual","title-slide-attributes":{"data-background-image":"elephant.png","data-background-size":"25%","data-background-position":"90% 80%"},"include-in-header":[{"text":"<style>\n#title-slide .title {\n  font-size: 1.5em;\n  color: black;\n}\n</style>\n"}]},"headingText":"Pooling Effect Sizes","headingAttr":{"id":"","classes":["smaller"],"keyvalue":[]},"containsRefs":false,"markdown":"\n\n\nPooling effect sizes is essential for synthesizing results across studies in meta-analysis. Different models can be employed based on the data structure and assumptions.\n\n------------------------------------------------------------------------\n\n## Fixed-Effect Model {.smaller}\n\nThe **Fixed-Effect Model** assumes that all studies estimate the same underlying effect size.\n\n### Key Features:\n\n-   Assumes homogeneity of effect sizes across studies.\n-   Only one common effect size is estimated.\n\n### Formula:\n\n$$\n\\hat{\\theta}_k = \\theta + \\varepsilon_k, \\quad \\varepsilon_k \\sim \\mathcal{N}(0, s_k^2)\n$$\n\n## Fixed-Effect Model {.smaller}\n\n### Weighting:\n\n$$\n\\bar{\\theta}_w = \\frac{\\sum_{i=1}^{k} w_i \\hat{\\theta}_i}{\\sum_{i=1}^{k} w_i}\n$$\n\nWhere:\n\n-   bar_theta_w is the **weighted average effect size** across ( k ) studies.\n\n-   hat_theta_i is the **estimated effect size** for the ( i )-th study.\n\n-   w_i is the **weight** for the ( i )-th study.\n\n-   v_i is the **variance** of the ( i )-th study.\n\n    and with weights equal to ğ‘¤ğ‘–=1/ğ‘£ğ‘–\n\n## Fixed-Effect Model {.smaller}\n\nLet's say: trueRR=1.5; and $$\\hat{\\theta}_k = \\theta + \\varepsilon_k$$\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 600\n# Load necessary libraries\nlibrary(shiny)\nlibrary(metafor)\nlibrary(ggplot2)\nlibrary(truncnorm)\n\n# Define UI\nui <- fluidPage(\n  titlePanel(\"Forest Plot with Fixed Effect Model\"),\n  \n  sidebarLayout(\n    sidebarPanel(\n      sliderInput(\"sd_true\", \"Standard Deviation of True Effect Size:\",\n                  min = 0, max = 1, value = 0.05, step = 0.01),\n      sliderInput(\"sd_sampling\", \"Standard Deviation of Sampling Error:\",\n                  min = 0, max = 1, value = 0.2, step = 0.01),\n      sliderInput(\"n_studies\", \"Number of Studies:\",\n                  min = 1, max = 100, value = 5, step = 1)\n    ),\n    \n    mainPanel(\n      plotOutput(\"forestPlot\")\n    )\n  )\n)\n\n# Define server logic\nserver <- function(input, output) {\n  \n  output$forestPlot <- renderPlot({\n    # Set parameters\n    set.seed(113)  # For reproducibility\n    true_effect_size <- 1.5  # Specify a true effect size (e.g., ratio)\n    sd_true <- input$sd_true\n    sd_sampling <- input$sd_sampling\n    n_studies <- input$n_studies\n    sample_sizes <- sample(20:100, n_studies)  # Random sample sizes for each study\n\n    # Generate studies data\n    studies <- data.frame(\n      study = paste(\"Study\", 1:n_studies),\n      n = sample_sizes\n    )\n    \n    # Generate random effect sizes with associated sampling error\n    studies$mean_ratio <- true_effect_size+rnorm(n_studies, mean = 0, sd = sd_sampling)\n    \n    # Generate standard errors from a truncated normal distribution\n    studies$se <- rtruncnorm(n_studies, a = 0, mean = 0.2, sd = 0.1)\n    \n    # Calculate confidence intervals\n    studies$ci_lower <- studies$mean_ratio - 1.96 * studies$se\n    studies$ci_upper <- studies$mean_ratio + 1.96 * studies$se\n    studies$color = 2\n    \n    # Calculate mean and CI for the overall effect size using a fixed-effects model\n    fixed_effect <- rma(yi = mean_ratio, sei = se, method = \"FE\",data=studies)\n     fixed_effectUN <- rma(yi = mean_ratio, sei = se, method = \"FE\",weighted=FALSE,data=studies)\n    \n     # Extract relevant information from the fixed_effect object\n    summary_table <- data.frame(\n      study = \"Overall_weighted\",\n      n = NA,\n      mean_ratio = fixed_effect$b,\n      se = NA,  # Standard error not directly available for overall effect size\n      ci_lower = fixed_effect$ci.lb,\n      ci_upper = fixed_effect$ci.ub,\n      color = 1\n    )\n    \n         # Extract relevant information from the fixed_effect object\n    summary_tableUN <- data.frame(\n      study = \"Overall_unweighted\",\n      n = NA,\n      mean_ratio = fixed_effectUN$b,\n      se = NA,  # Standard error not directly available for overall effect size\n      ci_lower = fixed_effectUN$ci.lb,\n      ci_upper = fixed_effectUN$ci.ub,\n      color = 1\n    )\n    \n    # Combine study data with overall effect size\n    plot_data <- rbind(studies, summary_table)\n     plot_data <- rbind(plot_data, summary_tableUN)\n    \n    # Create forest plot\n    forest_plot <- ggplot(plot_data, aes(x = reorder(study, rev(study)), y = mean_ratio)) +\n      geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), width = 0.2, size = 1) + \n      geom_point(aes(color = factor(color))) +\n      geom_hline(yintercept = true_effect_size, linetype = \"dashed\", color = \"blue\") +  \n      labs(title = \"Forest Plot : Fixed Effect Model\",\n           subtitle = paste(\"IÂ² = \", round(fixed_effect$I2, 2), \"%\"),\n           x = \"Studies\",\n           y = \"Effect Size (Ratio)\") +\n      theme_minimal() +\n      theme(legend.position = \"none\") +  # Remove legend for clarity\n      coord_flip() +\n      # geom_rect(aes(xmin = -Inf, xmax = Inf, ymin = true_effect_size - 1.96 * sd_true, ymax = true_effect_size + 1.96 * sd_true), \n      #           fill = \"blue\", alpha = 0.1)+\n           geom_point(aes(size = 1/se, color = factor(color))) +\n      scale_size_continuous(range = c(2, 5))+\n      geom_text(aes(x=reorder(study, rev(study)), y=0.5, label=paste0(\"n=\",n)))+\n      geom_hline(yintercept = true_effect_size, linetype = \"dotted\", color = \"blue\")\n\n    # Display the forest plot\n    print(forest_plot)\n  })\n}\n\n# Run the application \nshinyApp(ui = ui, server = server)\n```\n\n## Fixed-Effect Model {.smaller}\n\n![](images/fixed%20model.png){fig-align=\"center\"}\n\n## Limitations of Fixed-Effect Models\n\n-   The outcome of interest could have been measured in many ways.\n\n-   The type of treatment may not have been exactly the same.\n\n-   The intensity and duration of treatment could differ.\n\n-   The target population of the studies may not have been exactly the same for each study.\n\n-   The control groups used may have been different.\n\n## Random-Effects Model {.smaller}\n\nThe **Random-Effects Model** accounts for variability among studies, assuming that effect sizes vary due to different study conditions.\n\n### Formula:\n\n$$\\hat{\\theta}_k = \\mu + \\zeta_k + \\epsilon_k ;  \\quad \\mathcal\\zeta_k \\sim {N}(0, ğ’¯^2) ; \\quad \\mathcal\\epsilon_k \\sim {N}(0, s_k^2)$$\n\n-   hat_theta_k: Estimated effect size for study ( k ).\n-   mu : The overall mean (or meta-analytic mean).\n-   ğœ_ğ‘˜: Random effect for study ( k ),ğ’¯\\^2 is the between-study variance.\n-   epsilon_k: error term, sk2is the within study variance\n\n## Random Model Estimation {.smaller}\n\n-   The weights are defined as:\n\n$$\nw_i^* = \\frac{1}{s_k^2 + \\tau^2}\n$$\n\nWhere:\n\n-   ( \\hat{\\theta}\\_k ): Estimated effect size for study ( k ).\n-   ( \\mu ): The overall mean (or meta-analytic mean).\n-   ( \\zeta\\_k \\sim \\mathcal{N}(0, \\tau\\^2) ): Random effect for study ( k ), where ( \\tau\\^2 ) is the between-study variance.\n-   ( \\epsilon\\_k \\sim \\mathcal{N}(0, v_k) ): Within-study error term for study ( k ), where ( v_k ) is the variance of the effect size estimate for study ( k ).\n\n## Heterogeneity : IÂ² Statistic {.smaller}\n\n-   **Definition**:\n\n    -   IÂ² (I-squared) is a measure of the percentage of variation across studies that is attributable to heterogeneity rather than chance.\n\n-   **Importance**:\n\n    -   Understanding IÂ² helps researchers assess the consistency of results across studies.\n    -   It informs decisions on whether to use fixed or random effects models in meta-analyses.\n\n-   **Calculation**:\n\n    -   IÂ² is calculated from the Q statistic:\n\n    $$  IÂ² = 100\\% \\times \\frac{\\tau^2}{\\tau^2 + s^2}$$\n\n    Where: ğ’¯\\^2 is the between-study variance. sk2is the within study variance\n\n## IÂ² Statistic {.smaller}\n\n-   **Considerations**:\n    -   High IÂ² values do not always imply that meta-analysis is inappropriate.\n    -   Subgroup analyses and meta-regressions can help explore sources of heterogeneity.\n-   **Interpretation**:\n    -   **0%**: No heterogeneity. All studies have similar effects.\n    -   **1-25%**: Low heterogeneity. Minor variations among studies.\n    -   **25-50%**: Moderate heterogeneity. Some differences in effects.\n    -   **50-75%**: Substantial heterogeneity. Notable variations among studies.\n    -   **75-100%**: Considerable heterogeneity. Major differences in effects.\n\n## Mixed Model Estimation {.scrollable}\n\nLet's say: trueRR=1.5; and (ğœƒ_ğ‘˜ )Â Ì‚=ğœ‡+ ğœ_ğ‘˜+ ğœ€_ğ‘˜\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 600\n# Load necessary libraries\nlibrary(shiny)\nlibrary(metafor)\nlibrary(ggplot2)\nlibrary(truncnorm)\nlibrary(gridExtra)\n\n# Define UI\nui <- fluidPage(\n  titlePanel(\"Forest Plot with Fixed Effect Model\"),\n  \n  sidebarLayout(\n    sidebarPanel(\n      sliderInput(\"sd_true\", \"Standard Deviation of True Effect Size:\",\n                  min = 0, max = 1, value = 0.05, step = 0.01),\n      sliderInput(\"sd_sampling\", \"Standard Deviation of Sampling Error:\",\n                  min = 0, max = 1, value = 0.2, step = 0.01),\n      sliderInput(\"n_studies\", \"Number of Studies:\",\n                  min = 1, max = 10, value = 5, step = 1),\n       checkboxInput(\"show_mean\", \"show_mean_without_sample_error\", value = TRUE)\n    ),\n    \n    mainPanel(\n      plotOutput(\"forestPlot\")\n    )\n  )\n)\n\n# Define server logic\nserver <- function(input, output) {\n  \n  output$forestPlot <- renderPlot({\n    # Set parameters\n    set.seed(113)  # For reproducibility\n    true_effect_size <- 1.5  # Specify a true effect size (e.g., ratio)\n    sd_true <- input$sd_true\n    sd_sampling <- input$sd_sampling\n    n_studies <- input$n_studies\n    sample_sizes <- sample(20:100, n_studies)  # Random sample sizes for each study\n\n    # Generate studies data\n    studies <- data.frame(\n      study = paste(\"Study\", 1:n_studies),\n      n = sample_sizes\n    )\n    \n    # Generate random effect sizes with associated sampling error\n    studies$mean_1 <- rnorm(n_studies, mean = true_effect_size, sd = sd_true)\n    studies$mean_ratio<- studies$mean_1+rnorm(n_studies, mean = 0, sd = sd_sampling)\n    \n    # Generate standard errors from a truncated normal distribution\n    studies$se <- rtruncnorm(n_studies, a = 0, mean = 0.2, sd = 0.1)\n    \n    # Calculate confidence intervals\n    studies$ci_lower <- studies$mean_ratio - 1.96 * studies$se\n    studies$ci_upper <- studies$mean_ratio + 1.96 * studies$se\n    studies$color = 2\n    \n    # Calculate mean and CI for the overall effect size using a fixed-effects model\n    random_effect <- rma(yi = mean_ratio, sei = se,data=studies)\n     fixed_effectUN <- rma(yi = mean_ratio, sei = se, method = \"FE\",weighted=FALSE,data=studies)\n    \n     # Extract relevant information from the random_effect object\n    summary_table <- data.frame(\n      study = \"Overall_random_effect\",\n      n = NA,\n      mean_1 = NA,\n      mean_ratio = random_effect$b,\n      se = NA,  # Standard error not directly available for overall effect size\n      ci_lower = random_effect$ci.lb,\n      ci_upper = random_effect$ci.ub,\n      color = 1\n    )\n    \n         # Extract relevant information from the fixed_effect object\n    summary_tableUN <- data.frame(\n      study = \"Overall_unweighted\",\n      n = NA,\n      mean_1 = NA,\n      mean_ratio = fixed_effectUN$b,\n      se = NA,  # Standard error not directly available for overall effect size\n      ci_lower = fixed_effectUN$ci.lb,\n      ci_upper = fixed_effectUN$ci.ub,\n      color = 1\n    )\n    \n    # Combine study data with overall effect size\n    plot_data <- rbind(studies, summary_table)\n     plot_data <- rbind(plot_data, summary_tableUN)\n    \n     \n     k <- random_effect$k\n     wi <- 1/random_effect$vi\n     vt <- (k-1) * sum(wi) / (sum(wi)^2 - sum(wi^2))\n     tau_squared<- random_effect$tau2\n     total_variability <- vt + tau_squared\n     \n     data <- data.frame(\n  VarianceType = c(\"Between-study Variance (Ï„Â²)\", \"Sampling Variability (ÏƒÂ²)\"),\n  Proportion = c(tau_squared / total_variability, vt / total_variability)\n)\n\n\n    # Create forest plot\n    p1<-forest_plot <- ggplot(plot_data, aes(x = reorder(study, rev(study)))) +\n      geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), width = 0.2, size = 1) + \n      geom_point(aes(y = mean_ratio,color = factor(color))) +\n      {if (input$show_mean) geom_point(aes(y = mean_1), color = \"red\", size = 4, pch = 8)\n      }+\n      geom_hline(yintercept = true_effect_size, linetype = \"dashed\", color = \"blue\") +  \n      labs(title = \"Forest Plot : Random Effect Model\",\n           subtitle = paste(\"IÂ² = \", round(random_effect$I2, 2), \"%\"),\n           x = \"Studies\",\n           y = \"Effect Size (Ratio)\") +\n      theme_minimal() +\n      theme(legend.position = \"none\") +  # Remove legend for clarity\n      coord_flip() +\n       geom_rect(aes(xmin = -Inf, xmax = Inf,\n                     ymin = true_effect_size - 1.96 * sd_true,\n                     ymax = true_effect_size + 1.96 * sd_true), \n                 fill = \"blue\", alpha = 0.05)+\n           geom_point(aes(y = mean_ratio,size = 1/se, color = factor(color))) +\n      scale_size_continuous(range = c(2, 5))+\n      geom_text(aes(x=reorder(study, rev(study)), y=0.5, label=paste0(\"n=\",n)))+\n      geom_hline(yintercept = true_effect_size, linetype = \"dotted\", color = \"blue\")\n\n    \n    p2<- ggplot(data, aes(x = \"\", y = Proportion, fill = VarianceType)) +\n     geom_bar(stat = \"identity\") +  # Flip the axes for better readability\n     labs(title = \"Proportions of Variance in Meta-analysis (IÂ²)\",\n          x = \"\",\n          y = \"Proportion\") +\n     scale_fill_manual(values = c(\"#FF9999\", \"#66B3FF\")) +  # Custom colors\n     theme_minimal() +\n     theme(legend.title = element_blank())+coord_flip()\n    \n    \n    # Display the forest plot\n   grid.arrange(p1, p2, ncol = 1, heights = c(3, 1))\n  })\n}\n\n# Run the application \nshinyApp(ui = ui, server = server)\n```\n\n## Methods for Estimating Ï„Â²\n\n-   **DerSimonian-Laird (DL)**: Widely used but underestimates with high heterogeneity.\n-   **Restricted Maximum Likelihood (REML)**: Less biased, recommended for small samples.\n-   **Hedges & Olkin (HO)**: Adjusted moment estimator.\n-   **Paule-Mandel (PM)**: Performs well under high heterogeneity.\n-   **Bayesian Estimation**: Provides a distribution for Ï„Â², useful with prior knowledge.\n\n## Understanding Knapp-Hartung Adjustments {.smaller}\n\n-   The **Knapp-Hartung Adjustments** are applied to improve the accuracy of **confidence intervals** in random-effects meta-analyses.\n\n-   They adjust the **standard errors** of the pooled effect size to account for the uncertainty in estimating between-study variance (Ï„Â²).\n\n-   More **conservative** than traditional methods, resulting in **wider confidence intervals**, especially when the number of studies is small or heterogeneity is high.\n\n-   Recommended for **meta-analyses with few studies** (\\< 10).\n\n-   Useful when between-study heterogeneity is suspected but difficult to quantify accurately.\n\n-   Can prevent **false positives** by reducing the risk of overestimating precision.\n\n## Mixed Model Estimation {.scrollable}\n\n### ![](images/random_model.png){fig-align=\"center\"}\n\n## When a Two-Level Model Falls Short {.smaller}\n\n1. **Does Not Handle Nested Data**:\n   - Ignores study-level clustering (e.g., multiple outcomes or time points within a study).\n\n2. **Overlooks Between-Group Variability**:\n   - Cannot account for variability across different study groups (e.g., regions, experimental designs).\n\n3. **Simplified Heterogeneity Structure**:\n   - Assumes a single \\(\\tau^2\\), ignoring differences in heterogeneity across subgroups.\n\n4. **Reduced Power with Small \\(k\\)**:\n   - Two-level models struggle to detect variance components when \\(k\\) (number of studies) is small.\n\n5. **Ignores Dependency Structures**:\n   - Cannot model dependencies between subgroups or repeated measures.\n\n## Three-Level Meta-Analytic Model {.smaller}\n\nOverview\n\nThree-level meta-analysis extends the traditional random-effects model by incorporating an additional level to account for dependencies in the data, such as multiple effect sizes within studies. This approach models the variability at three levels:\n\n1.  **Level 1**: Sampling variability within effect sizes.\n2.  **Level 2**: Variability between effect sizes within group\n3.  **Level 3**: Variability between studies.\n\n### Purpose of the Model {.smaller}\n\nThe three-level model is ideal for datasets with hierarchical structures, allowing for accurate estimation of variance components and avoiding underestimation of standard errors. This model is frequently used when there are multiple outcomes per study or when primary studies include repeated measures.\n\n## Three-Level Meta-Analytic Model {.smaller .scrollable}\n\n### Formula\n\n$$\\hat{\\theta}_{ij} = \\mu + \\zeta_{(2)ij} + \\zeta_{(3)j} + \\epsilon_{ij}$$\n\n$$\\zeta_{(2)ij} \\sim N(0, \\tau_1^2); \\quad \\zeta_{(3)j} \\sim N(0, \\tau_2^2); \\quad \\epsilon_{ij} \\sim N(0, s_{ij}^2)$$\n\nWhere:\n\n-   hat_theta_ikj: Estimated effect size for the i-th effect size in the j-th cluster\n-   mu: The overall mean effect size.\n-   \\zeta_{(2)ij}: within-cluster heterogeneity \n - \\zeta_{(3)j}: between-cluster heterogeneity\n-   epsilon_ikj: Error term, with ( v\\_{ij} ) representing the sampling variance.\n\n\n\n<br>\n<br>\n<br>\n\nCependant, si on reformule le modÃ¨le pour considÃ©rer un effet moyen spÃ©cifique Ã  chaque groupe \\(\\kappa_j\\), la notation devient :\n\n$$theta_{ij} = \\kappa_j + \\zeta^{(2)}_{ij} + \\epsilon_{ij}, \\quad \\text{avec} \\quad \\kappa_j = \\mu + \\zeta^{(3)}_j$$\n\n$$Dans ce cas, (kappa_j)  est l'effet moyen du groupe (j), et (\\zeta^{(2)}_{ij} \\sim N(0, \\tau^2_2)\\ reste centrÃ© autour de \\(\\kappa_j\\).$$\n\n## Three level random effect model: weights\n\n. - Weights for individual effect sizes are defined as:\n\n$$\nw_{ij} = \\frac{1}{\\tau_1^2 + \\tau_2^2 + s_{ij}^2}\n$$\n\n## Three level random effect model\n\nLet's say RR=1.5; (ğœƒ_ğ‘˜ )Â Ì‚=ğœ‡+ ğœ\\_((2)ğ‘—ğ‘˜)+ğœ\\_((3)ğ‘—) ã€–+ ğœ€ã€—\\_ğ‘—ğ‘˜\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 600\n# Load necessary libraries\nlibrary(shiny)\nlibrary(metafor)\nlibrary(ggplot2)\nlibrary(truncnorm)\nlibrary(gridExtra)\nlibrary(dplyr)\nlibrary(magrittr)\n\n# Define UI\nui <- fluidPage(\n  titlePanel(\"Forest Plot with Three-Level Meta-Analytical Model\"),\n  \n  sidebarLayout(\n    sidebarPanel(\n      sliderInput(\"sd_true\", \"Standard Deviation of True Effect Size:\",\n                  min = 0, max = 1, value = 0, step = 0.01,),\n      sliderInput(\"sd_sampling\", \"Standard Deviation of Sampling Error:\",\n                  min = 0, max = 1, value = 0, step = 0.01),\n      sliderInput(\"sd_group\", \"Standard Deviation of Group Effect:\",\n                  min = 0, max = 1, value = 0, step = 0.01),  # New slider for group effect variance\n      sliderInput(\"n_studies\", \"Number of Studies:\",\n                  min = 3, max = 15, value = 3, step = 1),\n      sliderInput(\"n_groups\", \"Number of Groups:\",\n                  min = 2, max = 5, value = 2, step = 1),\n      checkboxInput(\"show_mean\", \"Show mean without sample error\", value = TRUE)\n    ),\n    \n    mainPanel(\n      plotOutput(\"forestPlot\")\n    )\n  )\n)\n\n# Define server logic\nserver <- function(input, output) {\n  \n  output$forestPlot <- renderPlot({\n    # Set parameters\n    set.seed(113)  # For reproducibility\n    true_effect_size <- 1.5  # Specify a true effect size (e.g., ratio)\n    sd_true <- input$sd_true\n    sd_sampling <- input$sd_sampling\n    sd_group <- input$sd_group  # Standard deviation for group effects\n    n_studies <- input$n_studies\n    n_groups <- input$n_groups\n    \n    # Assign each study to a group\n    group_assignments <- rep(1:n_groups, length.out = n_studies)\n    \n    # Generate studies data\n    studies <- data.frame(\n      study = paste(\"Study\", 1:n_studies),\n      n = sample(20:100, n_studies),  # Random sample sizes for each study\n      group = factor(group_assignments)\n    ) %>% arrange(group) %>% mutate(study = paste(\"Study\", 1:n_studies))\n\n    # Generate random group effects and add to the true effect sizes\n       tmp1<- rnorm(n_groups - 1, mean = 0, sd = sd_group)\n    group_effects <- c(tmp1,-sum(tmp1))\n    studies$group_effect <- group_effects[studies$group]\n    \n    # Generate true effect sizes with associated group and sampling error\n    studies$group_effect<- studies$group_effect+  true_effect_size\n    tmp<- rnorm(n_studies - 1, mean = 0, sd = sd_true)\n    studies$mean_1 <- studies$group_effect+ c(tmp,-sum(tmp))\n    \n    studies$mean_ratio <- studies$mean_1 + rnorm(n_studies, mean = 0, sd = sd_sampling)\n    \n    # Generate standard errors from a truncated normal distribution\n    studies$se <-0.01+sd_sampling* rtruncnorm(n_studies, a = 0, mean = 0.1, sd = 0.1)\n    \n    # Calculate confidence intervals\n    studies$ci_lower <- studies$mean_ratio - 1.96 * studies$se\n    studies$ci_upper <- studies$mean_ratio + 1.96 * studies$se\n    studies$color <- 2\n    \n    # Calculate overall effect size using a three-level model\n    random_effect <- rma.mv(yi = mean_ratio, V = se^2, random = ~ 1 | group/study, data = studies)\n    \n    # Create summary table for the overall effect size\n    summary_table <- data.frame(\n      study = \"Overall_random_effect\",\n      n = NA,\n      group = NA,\n      mean_1 = NA,\n      group_effect = NA,\n      mean_ratio = random_effect$b,\n      se = NA,\n      ci_lower = random_effect$ci.lb,\n      ci_upper = random_effect$ci.ub,\n      color = 1\n    )\n    \n    # Combine study data with overall effect size\n    plot_data <- rbind(studies, summary_table)\n    \n\n  #  Create forest plot\n    p1 <- ggplot(plot_data, aes(x = reorder(study, rev(group)))) +\n      geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), width = 0.2, size = 1) +\n      geom_point(aes(y = mean_ratio, color = factor(group))) +\n   {if (input$show_mean) geom_point(aes(y = mean_1), color = \"red\", size = 4, pch = 8)} +\n     {if (input$show_mean) geom_point(aes(y = group_effect), color = \"orange\", size = 4, pch = 9)} +\n      geom_hline(yintercept = true_effect_size, linetype = \"dashed\", color = \"blue\") +\n      labs(title = \"Forest Plot: Three-Level Meta-Analysis Model\",\n           x = \"Studies\",\n           y = \"Effect Size (Ratio)\") +\n      theme_minimal() +\n      theme(legend.position = \"none\") +\n      coord_flip() +\n      geom_text(aes(x = reorder(study, rev(study)), y = 0.5, label = paste0(\"Group = \", group, \"; n = \", n))) +\n      scale_size_continuous(range = c(2, 5)) +\n      geom_hline(yintercept = true_effect_size, linetype = \"dotted\", color = \"blue\")+\n             geom_rect(aes(xmin = -Inf, xmax = Inf,\n                     ymin = true_effect_size - 1.96 * sd_true,\n                     ymax = true_effect_size + 1.96 * sd_true), \n                 fill = \"blue\", alpha = 0.05)\n\n    # Display the forest plot\n    p1\n  })\n}\n\n# Run the application \nshinyApp(ui = ui, server = server)\n```\n\n## Three level random effect model\n\n![](images/3_level.png){fig-align=\"center\"}\n\n\n## Subgroup Analyses {.smaller}\n\n### Definition\n- **Subgroup Analysis** involves dividing studies into distinct groups based on specific characteristics to assess whether effect sizes vary across these groups.\n\n### Purpose\n- To identify factors that influence the effect of an intervention and to better understand heterogeneity among study results.\n\n---\n\n## When to Conduct Subgroup Analyses {.smaller}\n\n### Criteria for Subgroup Analysis\n- **Significant Heterogeneity:** High IÂ² values suggest further investigation is warranted.\n- **Hypothesis Testing:** When researchers have specific hypotheses regarding differences in effects.\n- **Interest in Specific Populations:** To evaluate how different demographics (e.g., age, gender) respond to an intervention.\n\n---\n\n## Methodology of Subgroup Analyses {.smaller}\n\n### Statistical Approach\n- Analyze subsets of data separately and compare effect sizes across groups.\n- Use a meta-analytic model for each subgroup, maintaining consistency with overall methodology.\n\n### Formula\n- For subgroup analyses, the overall model can be modified to include group-specific parameters:\n\n$$\n\\hat{\\theta}_{g,k} = \\mu_g + \\zeta_{g,k} + \\epsilon_{g,k}\n$$\n\nWhere:\n- \\( \\hat{\\theta}_{g,k} \\): Estimated effect size for study \\( k \\) in group \\( g \\).\n- \\( \\mu_g \\): Overall mean effect for group \\( g \\).\n- \\( \\zeta_{g,k} \\): Random effect for study \\( k \\) in group \\( g \\).\n- \\( \\epsilon_{g,k} \\): Error term for study \\( k \\) in group \\( g \\).\n\n---\n\n\n## Meta-Regression {.smaller}\n\n### Definition\n- **Meta-Regression** extends meta-analysis by examining how study-level covariates influence effect sizes.\n\n### Purpose\n- To explore relationships between study characteristics (e.g., sample size, intervention duration) and observed effects.\n\n---\n\n## Meta-Regression Methodology {.smaller}\n\n### Statistical Approach\n- The meta-regression model includes covariates that may explain variability in effect sizes:\n\n$$\n\\hat{\\theta}_k = \\mu + \\beta_1 x_1 + \\beta_2 x_2 + \\ldots + \\beta_p x_p + \\zeta_k + \\epsilon_k\n$$\n\nWhere:\n- \\( x_i \\): Study-level covariate.\n- \\( \\beta_i \\): Coefficient indicating the relationship between \\( x_i \\) and effect size.\n\n---\n\n## Benefits of Meta-Regression {.smaller}\n\n### Advantages\n- **Identify Predictors of Variability:** Helps clarify which factors influence intervention effectiveness.\n- **Informs Future Research Directions:** Insights from meta-regression can guide future studies and hypotheses.\n\n---\n\n## Challenges in Meta-Regression {.smaller}\n\n### Considerations\n- **Sample Size Requirements:** Requires sufficient studies with varying characteristics for robust results.\n- **Complexity of Interpretation:** Interactions among covariates can complicate understanding.\n\n","srcMarkdownNoYaml":"\n\n## Pooling Effect Sizes {.smaller}\n\nPooling effect sizes is essential for synthesizing results across studies in meta-analysis. Different models can be employed based on the data structure and assumptions.\n\n------------------------------------------------------------------------\n\n## Fixed-Effect Model {.smaller}\n\nThe **Fixed-Effect Model** assumes that all studies estimate the same underlying effect size.\n\n### Key Features:\n\n-   Assumes homogeneity of effect sizes across studies.\n-   Only one common effect size is estimated.\n\n### Formula:\n\n$$\n\\hat{\\theta}_k = \\theta + \\varepsilon_k, \\quad \\varepsilon_k \\sim \\mathcal{N}(0, s_k^2)\n$$\n\n## Fixed-Effect Model {.smaller}\n\n### Weighting:\n\n$$\n\\bar{\\theta}_w = \\frac{\\sum_{i=1}^{k} w_i \\hat{\\theta}_i}{\\sum_{i=1}^{k} w_i}\n$$\n\nWhere:\n\n-   bar_theta_w is the **weighted average effect size** across ( k ) studies.\n\n-   hat_theta_i is the **estimated effect size** for the ( i )-th study.\n\n-   w_i is the **weight** for the ( i )-th study.\n\n-   v_i is the **variance** of the ( i )-th study.\n\n    and with weights equal to ğ‘¤ğ‘–=1/ğ‘£ğ‘–\n\n## Fixed-Effect Model {.smaller}\n\nLet's say: trueRR=1.5; and $$\\hat{\\theta}_k = \\theta + \\varepsilon_k$$\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 600\n# Load necessary libraries\nlibrary(shiny)\nlibrary(metafor)\nlibrary(ggplot2)\nlibrary(truncnorm)\n\n# Define UI\nui <- fluidPage(\n  titlePanel(\"Forest Plot with Fixed Effect Model\"),\n  \n  sidebarLayout(\n    sidebarPanel(\n      sliderInput(\"sd_true\", \"Standard Deviation of True Effect Size:\",\n                  min = 0, max = 1, value = 0.05, step = 0.01),\n      sliderInput(\"sd_sampling\", \"Standard Deviation of Sampling Error:\",\n                  min = 0, max = 1, value = 0.2, step = 0.01),\n      sliderInput(\"n_studies\", \"Number of Studies:\",\n                  min = 1, max = 100, value = 5, step = 1)\n    ),\n    \n    mainPanel(\n      plotOutput(\"forestPlot\")\n    )\n  )\n)\n\n# Define server logic\nserver <- function(input, output) {\n  \n  output$forestPlot <- renderPlot({\n    # Set parameters\n    set.seed(113)  # For reproducibility\n    true_effect_size <- 1.5  # Specify a true effect size (e.g., ratio)\n    sd_true <- input$sd_true\n    sd_sampling <- input$sd_sampling\n    n_studies <- input$n_studies\n    sample_sizes <- sample(20:100, n_studies)  # Random sample sizes for each study\n\n    # Generate studies data\n    studies <- data.frame(\n      study = paste(\"Study\", 1:n_studies),\n      n = sample_sizes\n    )\n    \n    # Generate random effect sizes with associated sampling error\n    studies$mean_ratio <- true_effect_size+rnorm(n_studies, mean = 0, sd = sd_sampling)\n    \n    # Generate standard errors from a truncated normal distribution\n    studies$se <- rtruncnorm(n_studies, a = 0, mean = 0.2, sd = 0.1)\n    \n    # Calculate confidence intervals\n    studies$ci_lower <- studies$mean_ratio - 1.96 * studies$se\n    studies$ci_upper <- studies$mean_ratio + 1.96 * studies$se\n    studies$color = 2\n    \n    # Calculate mean and CI for the overall effect size using a fixed-effects model\n    fixed_effect <- rma(yi = mean_ratio, sei = se, method = \"FE\",data=studies)\n     fixed_effectUN <- rma(yi = mean_ratio, sei = se, method = \"FE\",weighted=FALSE,data=studies)\n    \n     # Extract relevant information from the fixed_effect object\n    summary_table <- data.frame(\n      study = \"Overall_weighted\",\n      n = NA,\n      mean_ratio = fixed_effect$b,\n      se = NA,  # Standard error not directly available for overall effect size\n      ci_lower = fixed_effect$ci.lb,\n      ci_upper = fixed_effect$ci.ub,\n      color = 1\n    )\n    \n         # Extract relevant information from the fixed_effect object\n    summary_tableUN <- data.frame(\n      study = \"Overall_unweighted\",\n      n = NA,\n      mean_ratio = fixed_effectUN$b,\n      se = NA,  # Standard error not directly available for overall effect size\n      ci_lower = fixed_effectUN$ci.lb,\n      ci_upper = fixed_effectUN$ci.ub,\n      color = 1\n    )\n    \n    # Combine study data with overall effect size\n    plot_data <- rbind(studies, summary_table)\n     plot_data <- rbind(plot_data, summary_tableUN)\n    \n    # Create forest plot\n    forest_plot <- ggplot(plot_data, aes(x = reorder(study, rev(study)), y = mean_ratio)) +\n      geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), width = 0.2, size = 1) + \n      geom_point(aes(color = factor(color))) +\n      geom_hline(yintercept = true_effect_size, linetype = \"dashed\", color = \"blue\") +  \n      labs(title = \"Forest Plot : Fixed Effect Model\",\n           subtitle = paste(\"IÂ² = \", round(fixed_effect$I2, 2), \"%\"),\n           x = \"Studies\",\n           y = \"Effect Size (Ratio)\") +\n      theme_minimal() +\n      theme(legend.position = \"none\") +  # Remove legend for clarity\n      coord_flip() +\n      # geom_rect(aes(xmin = -Inf, xmax = Inf, ymin = true_effect_size - 1.96 * sd_true, ymax = true_effect_size + 1.96 * sd_true), \n      #           fill = \"blue\", alpha = 0.1)+\n           geom_point(aes(size = 1/se, color = factor(color))) +\n      scale_size_continuous(range = c(2, 5))+\n      geom_text(aes(x=reorder(study, rev(study)), y=0.5, label=paste0(\"n=\",n)))+\n      geom_hline(yintercept = true_effect_size, linetype = \"dotted\", color = \"blue\")\n\n    # Display the forest plot\n    print(forest_plot)\n  })\n}\n\n# Run the application \nshinyApp(ui = ui, server = server)\n```\n\n## Fixed-Effect Model {.smaller}\n\n![](images/fixed%20model.png){fig-align=\"center\"}\n\n## Limitations of Fixed-Effect Models\n\n-   The outcome of interest could have been measured in many ways.\n\n-   The type of treatment may not have been exactly the same.\n\n-   The intensity and duration of treatment could differ.\n\n-   The target population of the studies may not have been exactly the same for each study.\n\n-   The control groups used may have been different.\n\n## Random-Effects Model {.smaller}\n\nThe **Random-Effects Model** accounts for variability among studies, assuming that effect sizes vary due to different study conditions.\n\n### Formula:\n\n$$\\hat{\\theta}_k = \\mu + \\zeta_k + \\epsilon_k ;  \\quad \\mathcal\\zeta_k \\sim {N}(0, ğ’¯^2) ; \\quad \\mathcal\\epsilon_k \\sim {N}(0, s_k^2)$$\n\n-   hat_theta_k: Estimated effect size for study ( k ).\n-   mu : The overall mean (or meta-analytic mean).\n-   ğœ_ğ‘˜: Random effect for study ( k ),ğ’¯\\^2 is the between-study variance.\n-   epsilon_k: error term, sk2is the within study variance\n\n## Random Model Estimation {.smaller}\n\n-   The weights are defined as:\n\n$$\nw_i^* = \\frac{1}{s_k^2 + \\tau^2}\n$$\n\nWhere:\n\n-   ( \\hat{\\theta}\\_k ): Estimated effect size for study ( k ).\n-   ( \\mu ): The overall mean (or meta-analytic mean).\n-   ( \\zeta\\_k \\sim \\mathcal{N}(0, \\tau\\^2) ): Random effect for study ( k ), where ( \\tau\\^2 ) is the between-study variance.\n-   ( \\epsilon\\_k \\sim \\mathcal{N}(0, v_k) ): Within-study error term for study ( k ), where ( v_k ) is the variance of the effect size estimate for study ( k ).\n\n## Heterogeneity : IÂ² Statistic {.smaller}\n\n-   **Definition**:\n\n    -   IÂ² (I-squared) is a measure of the percentage of variation across studies that is attributable to heterogeneity rather than chance.\n\n-   **Importance**:\n\n    -   Understanding IÂ² helps researchers assess the consistency of results across studies.\n    -   It informs decisions on whether to use fixed or random effects models in meta-analyses.\n\n-   **Calculation**:\n\n    -   IÂ² is calculated from the Q statistic:\n\n    $$  IÂ² = 100\\% \\times \\frac{\\tau^2}{\\tau^2 + s^2}$$\n\n    Where: ğ’¯\\^2 is the between-study variance. sk2is the within study variance\n\n## IÂ² Statistic {.smaller}\n\n-   **Considerations**:\n    -   High IÂ² values do not always imply that meta-analysis is inappropriate.\n    -   Subgroup analyses and meta-regressions can help explore sources of heterogeneity.\n-   **Interpretation**:\n    -   **0%**: No heterogeneity. All studies have similar effects.\n    -   **1-25%**: Low heterogeneity. Minor variations among studies.\n    -   **25-50%**: Moderate heterogeneity. Some differences in effects.\n    -   **50-75%**: Substantial heterogeneity. Notable variations among studies.\n    -   **75-100%**: Considerable heterogeneity. Major differences in effects.\n\n## Mixed Model Estimation {.scrollable}\n\nLet's say: trueRR=1.5; and (ğœƒ_ğ‘˜ )Â Ì‚=ğœ‡+ ğœ_ğ‘˜+ ğœ€_ğ‘˜\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 600\n# Load necessary libraries\nlibrary(shiny)\nlibrary(metafor)\nlibrary(ggplot2)\nlibrary(truncnorm)\nlibrary(gridExtra)\n\n# Define UI\nui <- fluidPage(\n  titlePanel(\"Forest Plot with Fixed Effect Model\"),\n  \n  sidebarLayout(\n    sidebarPanel(\n      sliderInput(\"sd_true\", \"Standard Deviation of True Effect Size:\",\n                  min = 0, max = 1, value = 0.05, step = 0.01),\n      sliderInput(\"sd_sampling\", \"Standard Deviation of Sampling Error:\",\n                  min = 0, max = 1, value = 0.2, step = 0.01),\n      sliderInput(\"n_studies\", \"Number of Studies:\",\n                  min = 1, max = 10, value = 5, step = 1),\n       checkboxInput(\"show_mean\", \"show_mean_without_sample_error\", value = TRUE)\n    ),\n    \n    mainPanel(\n      plotOutput(\"forestPlot\")\n    )\n  )\n)\n\n# Define server logic\nserver <- function(input, output) {\n  \n  output$forestPlot <- renderPlot({\n    # Set parameters\n    set.seed(113)  # For reproducibility\n    true_effect_size <- 1.5  # Specify a true effect size (e.g., ratio)\n    sd_true <- input$sd_true\n    sd_sampling <- input$sd_sampling\n    n_studies <- input$n_studies\n    sample_sizes <- sample(20:100, n_studies)  # Random sample sizes for each study\n\n    # Generate studies data\n    studies <- data.frame(\n      study = paste(\"Study\", 1:n_studies),\n      n = sample_sizes\n    )\n    \n    # Generate random effect sizes with associated sampling error\n    studies$mean_1 <- rnorm(n_studies, mean = true_effect_size, sd = sd_true)\n    studies$mean_ratio<- studies$mean_1+rnorm(n_studies, mean = 0, sd = sd_sampling)\n    \n    # Generate standard errors from a truncated normal distribution\n    studies$se <- rtruncnorm(n_studies, a = 0, mean = 0.2, sd = 0.1)\n    \n    # Calculate confidence intervals\n    studies$ci_lower <- studies$mean_ratio - 1.96 * studies$se\n    studies$ci_upper <- studies$mean_ratio + 1.96 * studies$se\n    studies$color = 2\n    \n    # Calculate mean and CI for the overall effect size using a fixed-effects model\n    random_effect <- rma(yi = mean_ratio, sei = se,data=studies)\n     fixed_effectUN <- rma(yi = mean_ratio, sei = se, method = \"FE\",weighted=FALSE,data=studies)\n    \n     # Extract relevant information from the random_effect object\n    summary_table <- data.frame(\n      study = \"Overall_random_effect\",\n      n = NA,\n      mean_1 = NA,\n      mean_ratio = random_effect$b,\n      se = NA,  # Standard error not directly available for overall effect size\n      ci_lower = random_effect$ci.lb,\n      ci_upper = random_effect$ci.ub,\n      color = 1\n    )\n    \n         # Extract relevant information from the fixed_effect object\n    summary_tableUN <- data.frame(\n      study = \"Overall_unweighted\",\n      n = NA,\n      mean_1 = NA,\n      mean_ratio = fixed_effectUN$b,\n      se = NA,  # Standard error not directly available for overall effect size\n      ci_lower = fixed_effectUN$ci.lb,\n      ci_upper = fixed_effectUN$ci.ub,\n      color = 1\n    )\n    \n    # Combine study data with overall effect size\n    plot_data <- rbind(studies, summary_table)\n     plot_data <- rbind(plot_data, summary_tableUN)\n    \n     \n     k <- random_effect$k\n     wi <- 1/random_effect$vi\n     vt <- (k-1) * sum(wi) / (sum(wi)^2 - sum(wi^2))\n     tau_squared<- random_effect$tau2\n     total_variability <- vt + tau_squared\n     \n     data <- data.frame(\n  VarianceType = c(\"Between-study Variance (Ï„Â²)\", \"Sampling Variability (ÏƒÂ²)\"),\n  Proportion = c(tau_squared / total_variability, vt / total_variability)\n)\n\n\n    # Create forest plot\n    p1<-forest_plot <- ggplot(plot_data, aes(x = reorder(study, rev(study)))) +\n      geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), width = 0.2, size = 1) + \n      geom_point(aes(y = mean_ratio,color = factor(color))) +\n      {if (input$show_mean) geom_point(aes(y = mean_1), color = \"red\", size = 4, pch = 8)\n      }+\n      geom_hline(yintercept = true_effect_size, linetype = \"dashed\", color = \"blue\") +  \n      labs(title = \"Forest Plot : Random Effect Model\",\n           subtitle = paste(\"IÂ² = \", round(random_effect$I2, 2), \"%\"),\n           x = \"Studies\",\n           y = \"Effect Size (Ratio)\") +\n      theme_minimal() +\n      theme(legend.position = \"none\") +  # Remove legend for clarity\n      coord_flip() +\n       geom_rect(aes(xmin = -Inf, xmax = Inf,\n                     ymin = true_effect_size - 1.96 * sd_true,\n                     ymax = true_effect_size + 1.96 * sd_true), \n                 fill = \"blue\", alpha = 0.05)+\n           geom_point(aes(y = mean_ratio,size = 1/se, color = factor(color))) +\n      scale_size_continuous(range = c(2, 5))+\n      geom_text(aes(x=reorder(study, rev(study)), y=0.5, label=paste0(\"n=\",n)))+\n      geom_hline(yintercept = true_effect_size, linetype = \"dotted\", color = \"blue\")\n\n    \n    p2<- ggplot(data, aes(x = \"\", y = Proportion, fill = VarianceType)) +\n     geom_bar(stat = \"identity\") +  # Flip the axes for better readability\n     labs(title = \"Proportions of Variance in Meta-analysis (IÂ²)\",\n          x = \"\",\n          y = \"Proportion\") +\n     scale_fill_manual(values = c(\"#FF9999\", \"#66B3FF\")) +  # Custom colors\n     theme_minimal() +\n     theme(legend.title = element_blank())+coord_flip()\n    \n    \n    # Display the forest plot\n   grid.arrange(p1, p2, ncol = 1, heights = c(3, 1))\n  })\n}\n\n# Run the application \nshinyApp(ui = ui, server = server)\n```\n\n## Methods for Estimating Ï„Â²\n\n-   **DerSimonian-Laird (DL)**: Widely used but underestimates with high heterogeneity.\n-   **Restricted Maximum Likelihood (REML)**: Less biased, recommended for small samples.\n-   **Hedges & Olkin (HO)**: Adjusted moment estimator.\n-   **Paule-Mandel (PM)**: Performs well under high heterogeneity.\n-   **Bayesian Estimation**: Provides a distribution for Ï„Â², useful with prior knowledge.\n\n## Understanding Knapp-Hartung Adjustments {.smaller}\n\n-   The **Knapp-Hartung Adjustments** are applied to improve the accuracy of **confidence intervals** in random-effects meta-analyses.\n\n-   They adjust the **standard errors** of the pooled effect size to account for the uncertainty in estimating between-study variance (Ï„Â²).\n\n-   More **conservative** than traditional methods, resulting in **wider confidence intervals**, especially when the number of studies is small or heterogeneity is high.\n\n-   Recommended for **meta-analyses with few studies** (\\< 10).\n\n-   Useful when between-study heterogeneity is suspected but difficult to quantify accurately.\n\n-   Can prevent **false positives** by reducing the risk of overestimating precision.\n\n## Mixed Model Estimation {.scrollable}\n\n### ![](images/random_model.png){fig-align=\"center\"}\n\n## When a Two-Level Model Falls Short {.smaller}\n\n1. **Does Not Handle Nested Data**:\n   - Ignores study-level clustering (e.g., multiple outcomes or time points within a study).\n\n2. **Overlooks Between-Group Variability**:\n   - Cannot account for variability across different study groups (e.g., regions, experimental designs).\n\n3. **Simplified Heterogeneity Structure**:\n   - Assumes a single \\(\\tau^2\\), ignoring differences in heterogeneity across subgroups.\n\n4. **Reduced Power with Small \\(k\\)**:\n   - Two-level models struggle to detect variance components when \\(k\\) (number of studies) is small.\n\n5. **Ignores Dependency Structures**:\n   - Cannot model dependencies between subgroups or repeated measures.\n\n## Three-Level Meta-Analytic Model {.smaller}\n\nOverview\n\nThree-level meta-analysis extends the traditional random-effects model by incorporating an additional level to account for dependencies in the data, such as multiple effect sizes within studies. This approach models the variability at three levels:\n\n1.  **Level 1**: Sampling variability within effect sizes.\n2.  **Level 2**: Variability between effect sizes within group\n3.  **Level 3**: Variability between studies.\n\n### Purpose of the Model {.smaller}\n\nThe three-level model is ideal for datasets with hierarchical structures, allowing for accurate estimation of variance components and avoiding underestimation of standard errors. This model is frequently used when there are multiple outcomes per study or when primary studies include repeated measures.\n\n## Three-Level Meta-Analytic Model {.smaller .scrollable}\n\n### Formula\n\n$$\\hat{\\theta}_{ij} = \\mu + \\zeta_{(2)ij} + \\zeta_{(3)j} + \\epsilon_{ij}$$\n\n$$\\zeta_{(2)ij} \\sim N(0, \\tau_1^2); \\quad \\zeta_{(3)j} \\sim N(0, \\tau_2^2); \\quad \\epsilon_{ij} \\sim N(0, s_{ij}^2)$$\n\nWhere:\n\n-   hat_theta_ikj: Estimated effect size for the i-th effect size in the j-th cluster\n-   mu: The overall mean effect size.\n-   \\zeta_{(2)ij}: within-cluster heterogeneity \n - \\zeta_{(3)j}: between-cluster heterogeneity\n-   epsilon_ikj: Error term, with ( v\\_{ij} ) representing the sampling variance.\n\n\n\n<br>\n<br>\n<br>\n\nCependant, si on reformule le modÃ¨le pour considÃ©rer un effet moyen spÃ©cifique Ã  chaque groupe \\(\\kappa_j\\), la notation devient :\n\n$$theta_{ij} = \\kappa_j + \\zeta^{(2)}_{ij} + \\epsilon_{ij}, \\quad \\text{avec} \\quad \\kappa_j = \\mu + \\zeta^{(3)}_j$$\n\n$$Dans ce cas, (kappa_j)  est l'effet moyen du groupe (j), et (\\zeta^{(2)}_{ij} \\sim N(0, \\tau^2_2)\\ reste centrÃ© autour de \\(\\kappa_j\\).$$\n\n## Three level random effect model: weights\n\n. - Weights for individual effect sizes are defined as:\n\n$$\nw_{ij} = \\frac{1}{\\tau_1^2 + \\tau_2^2 + s_{ij}^2}\n$$\n\n## Three level random effect model\n\nLet's say RR=1.5; (ğœƒ_ğ‘˜ )Â Ì‚=ğœ‡+ ğœ\\_((2)ğ‘—ğ‘˜)+ğœ\\_((3)ğ‘—) ã€–+ ğœ€ã€—\\_ğ‘—ğ‘˜\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 600\n# Load necessary libraries\nlibrary(shiny)\nlibrary(metafor)\nlibrary(ggplot2)\nlibrary(truncnorm)\nlibrary(gridExtra)\nlibrary(dplyr)\nlibrary(magrittr)\n\n# Define UI\nui <- fluidPage(\n  titlePanel(\"Forest Plot with Three-Level Meta-Analytical Model\"),\n  \n  sidebarLayout(\n    sidebarPanel(\n      sliderInput(\"sd_true\", \"Standard Deviation of True Effect Size:\",\n                  min = 0, max = 1, value = 0, step = 0.01,),\n      sliderInput(\"sd_sampling\", \"Standard Deviation of Sampling Error:\",\n                  min = 0, max = 1, value = 0, step = 0.01),\n      sliderInput(\"sd_group\", \"Standard Deviation of Group Effect:\",\n                  min = 0, max = 1, value = 0, step = 0.01),  # New slider for group effect variance\n      sliderInput(\"n_studies\", \"Number of Studies:\",\n                  min = 3, max = 15, value = 3, step = 1),\n      sliderInput(\"n_groups\", \"Number of Groups:\",\n                  min = 2, max = 5, value = 2, step = 1),\n      checkboxInput(\"show_mean\", \"Show mean without sample error\", value = TRUE)\n    ),\n    \n    mainPanel(\n      plotOutput(\"forestPlot\")\n    )\n  )\n)\n\n# Define server logic\nserver <- function(input, output) {\n  \n  output$forestPlot <- renderPlot({\n    # Set parameters\n    set.seed(113)  # For reproducibility\n    true_effect_size <- 1.5  # Specify a true effect size (e.g., ratio)\n    sd_true <- input$sd_true\n    sd_sampling <- input$sd_sampling\n    sd_group <- input$sd_group  # Standard deviation for group effects\n    n_studies <- input$n_studies\n    n_groups <- input$n_groups\n    \n    # Assign each study to a group\n    group_assignments <- rep(1:n_groups, length.out = n_studies)\n    \n    # Generate studies data\n    studies <- data.frame(\n      study = paste(\"Study\", 1:n_studies),\n      n = sample(20:100, n_studies),  # Random sample sizes for each study\n      group = factor(group_assignments)\n    ) %>% arrange(group) %>% mutate(study = paste(\"Study\", 1:n_studies))\n\n    # Generate random group effects and add to the true effect sizes\n       tmp1<- rnorm(n_groups - 1, mean = 0, sd = sd_group)\n    group_effects <- c(tmp1,-sum(tmp1))\n    studies$group_effect <- group_effects[studies$group]\n    \n    # Generate true effect sizes with associated group and sampling error\n    studies$group_effect<- studies$group_effect+  true_effect_size\n    tmp<- rnorm(n_studies - 1, mean = 0, sd = sd_true)\n    studies$mean_1 <- studies$group_effect+ c(tmp,-sum(tmp))\n    \n    studies$mean_ratio <- studies$mean_1 + rnorm(n_studies, mean = 0, sd = sd_sampling)\n    \n    # Generate standard errors from a truncated normal distribution\n    studies$se <-0.01+sd_sampling* rtruncnorm(n_studies, a = 0, mean = 0.1, sd = 0.1)\n    \n    # Calculate confidence intervals\n    studies$ci_lower <- studies$mean_ratio - 1.96 * studies$se\n    studies$ci_upper <- studies$mean_ratio + 1.96 * studies$se\n    studies$color <- 2\n    \n    # Calculate overall effect size using a three-level model\n    random_effect <- rma.mv(yi = mean_ratio, V = se^2, random = ~ 1 | group/study, data = studies)\n    \n    # Create summary table for the overall effect size\n    summary_table <- data.frame(\n      study = \"Overall_random_effect\",\n      n = NA,\n      group = NA,\n      mean_1 = NA,\n      group_effect = NA,\n      mean_ratio = random_effect$b,\n      se = NA,\n      ci_lower = random_effect$ci.lb,\n      ci_upper = random_effect$ci.ub,\n      color = 1\n    )\n    \n    # Combine study data with overall effect size\n    plot_data <- rbind(studies, summary_table)\n    \n\n  #  Create forest plot\n    p1 <- ggplot(plot_data, aes(x = reorder(study, rev(group)))) +\n      geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), width = 0.2, size = 1) +\n      geom_point(aes(y = mean_ratio, color = factor(group))) +\n   {if (input$show_mean) geom_point(aes(y = mean_1), color = \"red\", size = 4, pch = 8)} +\n     {if (input$show_mean) geom_point(aes(y = group_effect), color = \"orange\", size = 4, pch = 9)} +\n      geom_hline(yintercept = true_effect_size, linetype = \"dashed\", color = \"blue\") +\n      labs(title = \"Forest Plot: Three-Level Meta-Analysis Model\",\n           x = \"Studies\",\n           y = \"Effect Size (Ratio)\") +\n      theme_minimal() +\n      theme(legend.position = \"none\") +\n      coord_flip() +\n      geom_text(aes(x = reorder(study, rev(study)), y = 0.5, label = paste0(\"Group = \", group, \"; n = \", n))) +\n      scale_size_continuous(range = c(2, 5)) +\n      geom_hline(yintercept = true_effect_size, linetype = \"dotted\", color = \"blue\")+\n             geom_rect(aes(xmin = -Inf, xmax = Inf,\n                     ymin = true_effect_size - 1.96 * sd_true,\n                     ymax = true_effect_size + 1.96 * sd_true), \n                 fill = \"blue\", alpha = 0.05)\n\n    # Display the forest plot\n    p1\n  })\n}\n\n# Run the application \nshinyApp(ui = ui, server = server)\n```\n\n## Three level random effect model\n\n![](images/3_level.png){fig-align=\"center\"}\n\n\n## Subgroup Analyses {.smaller}\n\n### Definition\n- **Subgroup Analysis** involves dividing studies into distinct groups based on specific characteristics to assess whether effect sizes vary across these groups.\n\n### Purpose\n- To identify factors that influence the effect of an intervention and to better understand heterogeneity among study results.\n\n---\n\n## When to Conduct Subgroup Analyses {.smaller}\n\n### Criteria for Subgroup Analysis\n- **Significant Heterogeneity:** High IÂ² values suggest further investigation is warranted.\n- **Hypothesis Testing:** When researchers have specific hypotheses regarding differences in effects.\n- **Interest in Specific Populations:** To evaluate how different demographics (e.g., age, gender) respond to an intervention.\n\n---\n\n## Methodology of Subgroup Analyses {.smaller}\n\n### Statistical Approach\n- Analyze subsets of data separately and compare effect sizes across groups.\n- Use a meta-analytic model for each subgroup, maintaining consistency with overall methodology.\n\n### Formula\n- For subgroup analyses, the overall model can be modified to include group-specific parameters:\n\n$$\n\\hat{\\theta}_{g,k} = \\mu_g + \\zeta_{g,k} + \\epsilon_{g,k}\n$$\n\nWhere:\n- \\( \\hat{\\theta}_{g,k} \\): Estimated effect size for study \\( k \\) in group \\( g \\).\n- \\( \\mu_g \\): Overall mean effect for group \\( g \\).\n- \\( \\zeta_{g,k} \\): Random effect for study \\( k \\) in group \\( g \\).\n- \\( \\epsilon_{g,k} \\): Error term for study \\( k \\) in group \\( g \\).\n\n---\n\n\n## Meta-Regression {.smaller}\n\n### Definition\n- **Meta-Regression** extends meta-analysis by examining how study-level covariates influence effect sizes.\n\n### Purpose\n- To explore relationships between study characteristics (e.g., sample size, intervention duration) and observed effects.\n\n---\n\n## Meta-Regression Methodology {.smaller}\n\n### Statistical Approach\n- The meta-regression model includes covariates that may explain variability in effect sizes:\n\n$$\n\\hat{\\theta}_k = \\mu + \\beta_1 x_1 + \\beta_2 x_2 + \\ldots + \\beta_p x_p + \\zeta_k + \\epsilon_k\n$$\n\nWhere:\n- \\( x_i \\): Study-level covariate.\n- \\( \\beta_i \\): Coefficient indicating the relationship between \\( x_i \\) and effect size.\n\n---\n\n## Benefits of Meta-Regression {.smaller}\n\n### Advantages\n- **Identify Predictors of Variability:** Helps clarify which factors influence intervention effectiveness.\n- **Informs Future Research Directions:** Insights from meta-regression can guide future studies and hypotheses.\n\n---\n\n## Challenges in Meta-Regression {.smaller}\n\n### Considerations\n- **Sample Size Requirements:** Requires sufficient studies with varying characteristics for robust results.\n- **Complexity of Interpretation:** Interactions among covariates can complicate understanding.\n\n"},"formats":{"revealjs":{"identifier":{"display-name":"RevealJS","target-format":"revealjs","base-format":"revealjs"},"execute":{"fig-width":10,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":true,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","html-math-method":{"method":"mathjax","url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML-full"},"slide-level":2,"to":"revealjs","filters":["shinylive"],"include-in-header":[{"text":"<style>\n#title-slide .title {\n  font-size: 1.5em;\n  color: black;\n}\n</style>\n"}],"output-file":"Pool_ES.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":false,"quarto-version":"1.5.57","auto-stretch":true,"title":"How to calculate and combine effect-sizes?","subtitle":"September 2024","authors":"Damien Beillouin  <br/> CIRAD-Hortsys","editor":"visual","title-slide-attributes":{"data-background-image":"elephant.png","data-background-size":"25%","data-background-position":"90% 80%"},"chalkboard":true,"width":1150,"margin":0.08,"transition":"slide","backgroundTransition":"fade","slideNumber":true,"showSlideNumber":"print","footer":"How to calculate and combine effect-sizes?"}}},"projectFormats":[]}